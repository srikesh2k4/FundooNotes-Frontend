<header class="keep-header">
  <div class="header-container">

    <!-- Left Section: Menu & Logo -->
    <div class="header-left">
      <button
        class="menu-btn"
        aria-label="Main menu"
        (click)="onMenuClick()">
        <svg viewBox="0 0 24 24">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
        </svg>
      </button>

      <a href="/" class="logo-link" aria-label="Keep">
        <img
          src="https://www.gstatic.com/images/branding/product/1x/keep_2020q4_48dp.png"
          alt="Keep logo"
          class="logo-img">
        <span class="logo-text">Keep</span>
      </a>
    </div>

    <!-- Center Section: Search -->
    <div class="header-center">
      <form
        class="search-form"
        role="search"
        [class.active]="isSearchActive()"
        (submit)="onSearchSubmit($event)">

        <button
          class="search-back-btn"
          aria-label="Close search"
          type="button"
          (click)="clearSearch()">
          <svg viewBox="0 0 24 24">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>
          </svg>
        </button>

        <div class="search-icon">
          <svg viewBox="0 0 24 24">
            <path d="M20.49,19l-5.73-5.73C15.53,12.2,16,10.91,16,9.5C16,5.91,13.09,3,9.5,3S3,5.91,3,9.5C3,13.09,5.91,16,9.5,16 c1.41,0,2.7-0.47,3.77-1.24L19,20.49L20.49,19z M5,9.5C5,7.01,7.01,5,9.5,5S14,7.01,14,9.5S11.99,14,9.5,14S5,11.99,5,9.5z"></path>
          </svg>
        </div>

        <input
          type="text"
          class="search-input"
          placeholder="Search"
          aria-label="Search"
          autocomplete="off"
          [(ngModel)]="searchQuery"
          (input)="onSearchInput()"
          (focus)="onSearchFocus()"
          (blur)="onSearchBlur()">

        <button
          class="search-clear-btn"
          aria-label="Clear search"
          type="button"
          [class.visible]="searchQuery()"
          (click)="clearSearch()">
          <svg viewBox="0 0 24 24">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
          </svg>
        </button>
      </form>
    </div>

    <!-- Right Section: Actions & Profile -->
    <div class="header-right">
      <button
        class="icon-btn"
        aria-label="Refresh"
        (click)="onRefreshClick()">
        <svg viewBox="0 0 24 24">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
        </svg>
      </button>

      <button
        class="icon-btn"
        [attr.aria-label]="isGridView ? 'List view' : 'Grid view'"
        (click)="onViewToggleClick()">
        <!-- Grid view icon (shows when in grid mode, click to switch to list) -->
        <svg viewBox="0 0 24 24" *ngIf="isGridView">
          <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"></path>
        </svg>
        <!-- List view icon (shows when in list mode, click to switch to grid) -->
        <svg viewBox="0 0 24 24" *ngIf="!isGridView">
          <path d="M3 5v14h18V5H3zm4 2v2H5V7h2zm-2 6v-2h2v2H5zm0 2h2v2H5v-2zm14 2H9v-2h10v2zm0-4H9v-2h10v2zm0-4H9V7h10v2z"></path>
        </svg>
      </button>

      <!-- Settings with Dropdown -->
      <div class="settings-container">
        <button
          class="icon-btn"
          aria-label="Settings"
          (click)="toggleSettingsMenu()">
          <svg viewBox="0 0 24 24">
            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"></path>
          </svg>
        </button>

        <!-- Settings Dropdown Menu -->
        <div class="settings-dropdown" *ngIf="showSettingsMenu()" (mouseleave)="closeSettingsMenu()">
          <button class="dropdown-item" (click)="closeSettingsMenu()">
            <span>Settings</span>
          </button>
          <button class="dropdown-item" (click)="onToggleTheme()">
            <span>{{ themeService.isDark() ? 'Disable dark theme' : 'Enable dark theme' }}</span>
          </button>
          <button class="dropdown-item" (click)="closeSettingsMenu()">
            <span>Send feedback</span>
          </button>
          <button class="dropdown-item" (click)="closeSettingsMenu()">
            <span>Help</span>
          </button>
          <button class="dropdown-item" (click)="closeSettingsMenu()">
            <span>App downloads</span>
          </button>
          <button class="dropdown-item" (click)="closeSettingsMenu()">
            <span>Keyboard shortcuts</span>
          </button>
        </div>
      </div>

      <button
        class="icon-btn apps-btn"
        aria-label="Google apps"
        (click)="onAppsClick()">
        <svg viewBox="0 0 24 24">
          <path d="M6,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM6,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM12,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM16,6c0,1.1 0.9,2 2,2s2,-0.9 2,-2 -0.9,-2 -2,-2 -2,0.9 -2,2zM12,8c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,14c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2zM18,20c1.1,0 2,-0.9 2,-2s-0.9,-2 -2,-2 -2,0.9 -2,2 0.9,2 2,2z"></path>
        </svg>
      </button>

      <!-- Profile with Dropdown -->
      <div class="profile-container">
        <button
          class="profile-btn"
          [attr.aria-label]="'Google Account: ' + userProfile().name"
          (click)="toggleProfileMenu()">
          <img
            [src]="userProfile().avatar"
            [alt]="userProfile().name"
            class="profile-img"
            loading="eager">
        </button>

        <!-- Profile Dropdown Menu -->
        <div class="profile-dropdown" *ngIf="showProfileMenu()">
          <div class="dropdown-close-row">
            <span class="dropdown-email-top">{{ userProfile().email }}</span>
            <button class="dropdown-close-btn" (click)="closeProfileMenu()">
              <svg viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
              </svg>
            </button>
          </div>
          <div class="dropdown-profile-section">
            <img [src]="userProfile().avatar" [alt]="userProfile().name" class="dropdown-avatar-large">
            <div class="dropdown-greeting">Hi, {{ userProfile().name.split(' ')[0] }}!</div>
            <button class="manage-account-btn">Manage your Google Account</button>
          </div>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item sign-out-item" (click)="onLogout()">
            <svg viewBox="0 0 24 24">
              <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"></path>
            </svg>
            <span>Sign out of all accounts</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>
